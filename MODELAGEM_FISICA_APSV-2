--CRIANDO AS TABELAS
CREATE TABLE PESSOA(
	CDPESSOA SERIAL,
	CPF VARCHAR(19) NOT NULL UNIQUE,
	NOME VARCHAR(124) NOT NULL,
	DATA_NASC DATE NOT NULL
);
CREATE TYPE TIPO AS ENUM ('COM', 'RES', 'PES');
CREATE TABLE TELEFONE(
	CDTELEFONE SERIAL,
	TIPO_TELEFONE INT NOT NULL,
	DDD VARCHAR(2) NOT NULL,
	NUMERO VARCHAR(10) NOT NULL,
	CDPESSOA INT NOT NULL
);
CREATE TABLE ENDERECO(
	CDENDERECO SERIAL,
	RUA VARCHAR(256) NOT NULL,
	NUM_ENDERECO VARCHAR(7) NOT NULL,
	BAIRRO VARCHAR(64) NOT NULL,
	CIDADE VARCHAR(64) NOT NULL,
	ESTADO VARCHAR(2) NOT NULL,
	CEP VARCHAR(9) NOT NULL,
	CDPESSOA INT NOT NULL
);
CREATE TABLE CARGO(
	CDCARGO SERIAL,
	NIVELACESSO INT NOT NULL,
	NM_CARGO VARCHAR(64) NOT NULL
);
CREATE TABLE USUARIO_SENHA(
	CDUS SERIAL,
	USUARIO VARCHAR(128) NOT NULL UNIQUE,
	SENHA VARCHAR(256) NOT NULL
);
CREATE TABLE FUNCIONARIO(
	CDFUNCIONARIO SERIAL,
	SALARIO FLOAT NOT NULL,
	CDPESSOA INT NOT NULL,
	CDCARGO INT NOT NULL,
	CDUS INT NOT NULL
);
CREATE TABLE VENDA(
	CDVENDA SERIAL,
	DATA DATE NOT NULL
);
CREATE TYPE UNIDADE_MEDIDA AS ENUM ('L', 'ML', 'KG','G','M');

CREATE TABLE CARRINHO(
	CDCARRINHO SERIAL,
	CDFUNCIONARIO INT NOT NULL,
	CDVENDA INT NOT NULL,
	CDPRODUTO INT NOT NULL,
	QUANTIDADE INT NOT NULL,
	NU_CAIXA INT NOT NULL,
	TIPO_PAGAMENTO INT NOT NULL
);
CREATE TYPE PAGAMENTO AS ENUM ('CARTAOD', 'CARTAOC', 'VALEA','DINHEIRO');
CREATE TABLE PRODUTO(
	CDPRODUTO SERIAL,
	DESCR VARCHAR(256) NOT NULL,
	VALOR DOUBLE NOT NULL,
	MARCA VARCHAR(64) NOT NULL,
	UM UNIDADE_MEDIDA NOT NULL
);
CREATE TABLE ESTOQUE(
	CDESTOQUE SERIAL,
	CDPRODUTO INT NOT NULL,
	QUANTIDADE INT NOT NULL
);

--CRIANDO AS PK
ALTER TABLE PESSOA ADD PRIMARY KEY(CDPESSOA);
ALTER TABLE ENDERECO ADD PRIMARY KEY (CDENDERECO);
ALTER TABLE TELEFONE ADD PRIMARY KEY (CDTELEFONE);
ALTER TABLE CARGO ADD PRIMARY KEY (CDCARGO);
ALTER TABLE USUARIO_SENHA ADD PRIMARY KEY (CDUS);
ALTER TABLE FUNCIONARIO ADD PRIMARY KEY (CDFUNCIONARIO);
ALTER TABLE VENDA ADD PRIMARY KEY (CDVENDA);
ALTER TABLE CARRINHO ADD PRIMARY KEY (CDCARRINHO);
ALTER TABLE PRODUTO ADD PRIMARY KEY (CDPRODUTO);
ALTER TABLE ESTOQUE ADD PRIMARY KEY (CDESTOQUE);

--CRIANDO AS FK
ALTER TABLE TELEFONE
ADD CONSTRAINT FK_TELEFONE_PESSOA FOREIGN KEY (CDPESSOA)
REFERENCES PESSOA (CDPESSOA)
ON UPDATE CASCADE
ON DELETE NO ACTION;

ALTER TABLE ENDERECO
ADD CONSTRAINT FK_ENDERECO_PESSOA FOREIGN KEY (CDPESSOA)
REFERENCES PESSOA (CDPESSOA)
ON UPDATE CASCADE
ON DELETE NO ACTION;

ALTER TABLE FUNCIONARIO
ADD CONSTRAINT FK_FUNCIONARIO_PESSOA FOREIGN KEY (CDPESSOA)
REFERENCES PESSOA (CDPESSOA)
ON UPDATE CASCADE
ON DELETE NO ACTION;

ALTER TABLE FUNCIONARIO
ADD CONSTRAINT FK_FUNCIONARIO_CARGO FOREIGN KEY (CDCARGO)
REFERENCES CARGO (CDCARGO)
ON UPDATE CASCADE
ON DELETE NO ACTION;

ALTER TABLE FUNCIONARIO
ADD CONSTRAINT FK_FUNCIONARIO_USUARIO_SENHA FOREIGN KEY(CDUS)
REFERENCES USUARIO_SENHA(CDUS)
ON UPDATE CASCADE
ON DELETE NO ACTION;

ALTER TABLE CARRINHO
ADD CONSTRAINT FK_CARRINHO_FUNCIONARIO FOREIGN KEY(CDFUNCIONARIO)
REFERENCES FUNCIONARIO(CDFUNCIONARIO)
ON UPDATE CASCADE
ON DELETE NO ACTION;

ALTER TABLE CARRINHO
ADD CONSTRAINT FK_CARRINHO_VENDA FOREIGN KEY(CDVENDA)
REFERENCES VENDA(CDVENDA)
ON UPDATE CASCADE
ON DELETE NO ACTION;

ALTER TABLE CARRINHO
ADD CONSTRAINT FK_CARRINHO_PRODUTO FOREIGN KEY(CDPRODUTO)
REFERENCES PRODUTO(CDPRODUTO)
ON UPDATE CASCADE
ON DELETE NO ACTION;

ALTER TABLE ESTOQUE
ADD CONSTRAINT FK_ESTOQUE_PRODUTO FOREIGN KEY(CDPRODUTO)
REFERENCES PRODUTO(CDPRODUTO)
ON UPDATE CASCADE
ON DELETE NO ACTION;






























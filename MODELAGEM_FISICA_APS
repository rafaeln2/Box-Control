
-- CRIANDO AS TABELAS

CREATE TABLE PESSOA(
	CD_PESSOA SERIAL,
	NOME VARCHAR(255) NOT NULL,
	CPF VARCHAR(14) NOT NULL UNIQUE,
	DATA_NASC DATE NOT NULL

);

CREATE TABLE ENDERECO(
	CD_ENDERECO SERIAL,
	RUA VARCHAR(255) NOT NULL,
	NU_ENDERECO VARCHAR(255) NOT NULL,
	BAIRRO VARCHAR(255) NOT NULL,
	CIDADE VARCHAR(255) NOT NULL,
	UF VARCHAR(2) NOT NULL,
	CEP VARCHAR(9) NOT NULL,
	CD_PESSOA INT NOT NULL
);

CREATE TYPE TIPO AS ENUM ('COM', 'RES', 'PES');

CREATE TABLE TELEFONE(
	CD_TELEFONE SERIAL,
	TIPO_TELEFONE TIPO NOT NULL,
	DDD VARCHAR(2) NOT NULL,
	NUMERO VARCHAR(9) NOT NULL,
	CD_PESSOA INT NOT NULL
);

CREATE TABLE USUARIO_SENHA(
	CD_USUARIO_SENHA SERIAL,
	LOGIN VARCHAR(255) NOT NULL UNIQUE,
	SENHA VARCHAR(124) NOT NULL,
	CD_PESSOA INT NOT NULL
);

CREATE TABLE CARGO(
	CD_CARGO SERIAL,
	NIVEL_ACESSO INT NOT NULL,
	NM_CARGO VARCHAR(255) NOT NULL
);

CREATE TABLE FUNCIONARIO(
	CD_FUNCIONARIO SERIAL,
	SALARIO FLOAT NOT NULL,
	CD_PESSOA INT NOT NULL,
	CD_CARGO INT NOT NULL
);

CREATE TYPE UNIDADE_MEDIDA AS ENUM ('L', 'ML', 'KG','G','M');

CREATE TABLE PRODUTO(
	CD_PRODUTO SERIAL,
	NM_PRODUTO VARCHAR(60) NOT NULL,
	VALOR FLOAT NOT NULL,
	MARCA VARCHAR(255) NOT NULL,
	UNIDADE_MEDIDA_PRODUTO UNIDADE_MEDIDA NOT NULL,
	QUANTIDADE_PRODUTO FLOAT NOT NULL
);

CREATE TYPE PAGAMENTO AS ENUM ('CARTAOD', 'CARTAOC', 'VALEA','DINHEIRO');

CREATE TABLE PESSOA_CARRINHO(
	CD_PESSOA_CARRINHO SERIAL,
	CD_PRODUTO INT NOT NULL,
	QUANTIDADE INT NOT NULL,
	CD_PESSOA INT NOT NULL,
	TIPO_PAGAMENTO PAGAMENTO NOT NULL,
	DATA_COMPRA DATE NOT NULL
);

CREATE TABLE VENDA(
	CD_VENDA SERIAL,
	CD_FUNCIONARIO INT NOT NULL,
	CD_PESSOA_CARRINHO INT NOT NULL,
	NU_CAIXA INT NOT NULL
);

CREATE TABLE ESTOQUE(
	CD_ESTOQUE SERIAL,
	CD_PRODUTO INT NOT NULL UNIQUE,
	QUANTIDADE_ESTOQUE INT NOT NULL
);

-- CRIANDO AS PRIMARY KEYS
ALTER TABLE PESSOA ADD PRIMARY KEY (CD_PESSOA);
ALTER TABLE ENDERECO ADD PRIMARY KEY (CD_ENDERECO);
ALTER TABLE TELEFONE ADD PRIMARY KEY (CD_TELEFONE);
ALTER TABLE USUARIO_SENHA ADD PRIMARY KEY (CD_USUARIO_SENHA);
ALTER TABLE CARGO ADD PRIMARY KEY (CD_CARGO);
ALTER TABLE FUNCIONARIO ADD PRIMARY KEY (CD_FUNCIONARIO);
ALTER TABLE PRODUTO ADD PRIMARY KEY (CD_PRODUTO);
ALTER TABLE PESSOA_CARRINHO ADD PRIMARY KEY (CD_PESSOA_CARRINHO);
ALTER TABLE VENDA ADD PRIMARY KEY (CD_VENDA);
ALTER TABLE ESTOQUE ADD PRIMARY KEY (CD_ESTOQUE);

-- CRIANDO AS FOREIGN KEYS
  ALTER TABLE ENDERECO
  ADD CONSTRAINT FK_ENDERECO_PESSOA FOREIGN KEY (CD_PESSOA)
  REFERENCES PESSOA (CD_PESSOA)
  ON UPDATE CASCADE
  ON DELETE NO ACTION;
  
   ALTER TABLE TELEFONE
  ADD CONSTRAINT FK_TELEFONE_PESSOA FOREIGN KEY (CD_PESSOA)
  REFERENCES PESSOA (CD_PESSOA)
  ON UPDATE CASCADE
  ON DELETE NO ACTION;

  ALTER TABLE USUARIO_SENHA
  ADD CONSTRAINT FK_USUARIO_SENHA_PESSOA FOREIGN KEY (CD_PESSOA)
  REFERENCES PESSOA (CD_PESSOA)
  ON UPDATE CASCADE
  ON DELETE NO ACTION;
  
  ALTER TABLE FUNCIONARIO
  ADD CONSTRAINT FK_FUNCIONARIO_PESSOA FOREIGN KEY (CD_PESSOA)
  REFERENCES PESSOA (CD_PESSOA)
  ON UPDATE CASCADE
  ON DELETE NO ACTION;
  
  ALTER TABLE FUNCIONARIO
  ADD CONSTRAINT FK_FUNCIONARIO_CARGO FOREIGN KEY (CD_CARGO)
  REFERENCES CARGO(CD_CARGO)
  ON UPDATE CASCADE
  ON DELETE NO ACTION;
  
  ALTER TABLE PESSOA_CARRINHO
  ADD CONSTRAINT FK_PESSOA_CARRINHO_PRODUTO FOREIGN KEY (CD_PRODUTO)
  REFERENCES PRODUTO(CD_PRODUTO)
  ON UPDATE CASCADE
  ON DELETE NO ACTION;
  
  ALTER TABLE PESSOA_CARRINHO
  ADD CONSTRAINT FK_PESSOA_CARRINHO_PESSOA FOREIGN KEY (CD_PESSOA)
  REFERENCES PESSOA(CD_PESSOA)
  ON UPDATE CASCADE
  ON DELETE NO ACTION;
  
  ALTER TABLE VENDA
  ADD CONSTRAINT FK_VENDA_FUNCIONARIO FOREIGN KEY (CD_FUNCIONARIO)
  REFERENCES FUNCIONARIO(CD_FUNCIONARIO)
  ON UPDATE CASCADE
  ON DELETE NO ACTION;
  
  ALTER TABLE VENDA
  ADD CONSTRAINT FK_VENDA_PESSOA_CARRINHO FOREIGN KEY (CD_PESSOA_CARRINHO)
  REFERENCES PESSOA_CARRINHO(CD_PESSOA_CARRINHO)
  ON UPDATE CASCADE
  ON DELETE NO ACTION;
  
  ALTER TABLE ESTOQUE
  ADD CONSTRAINT FK_ESTOQUE_PRODUTO FOREIGN KEY (CD_PRODUTO)
  REFERENCES PRODUTO(CD_PRODUTO)
  ON UPDATE CASCADE
  ON DELETE NO ACTION;
  
  
  --INSERINDO PESSOAS
  INSERT INTO PESSOA(NOME,CPF,DATA_NASC) VALUES('BERNARDO LUZ','111111111','25/12/2000');
  INSERT INTO PESSOA(NOME,CPF,DATA_NASC) VALUES('BERNARDO SOUZA','22222222','25/10/1999');
  INSERT INTO PESSOA(NOME,CPF,DATA_NASC) VALUES('BOCA','33333333','28/05/1996');
  
  --INSERINDO ENDERECOS
  INSERT INTO ENDERECO(RUA,NU_ENDERECO,BAIRRO,CIDADE,UF,CEP,CD_PESSOA) VALUES ('GOVERNADOR ADOLFO KONDER','1','CAMPINAS','SAO JOSE','SC','11111',1);
  
  --INSERINDO TELEFONES
  INSERT INTO TELEFONE(TIPO_TELEFONE,DDD,NUMERO,CD_PESSOA) VALUES ('COM','48','991412512',1);

  --INSERINDO USUARIO_SENHA
  INSERT INTO USUARIO_SENHA(LOGIN,SENHA,CD_PESSOA) VALUES ('CHAVOZINHOBR','SENHASUPERSECRETA',1);
  
  --INSERINDO CARGO
  INSERT INTO CARGO(NIVEL_ACESSO,NM_CARGO) VALUES (1,'ADM');
  
  --INSERINDO FUNCIONARIO
  INSERT INTO FUNCIONARIO(SALARIO,CD_PESSOA,CD_CARGO) VALUES (255.55,1,1);
  
  --INSERINDO PRODUTO
  INSERT INTO PRODUTO(NM_PRODUTO,VALOR,MARCA,UNIDADE_MEDIDA_PRODUTO,QUANTIDADE_PRODUTO) VALUES ('NESCAUUU',5.50,'NESTLESY','G',500);
  INSERT INTO PRODUTO(NM_PRODUTO,VALOR,MARCA,UNIDADE_MEDIDA_PRODUTO,QUANTIDADE_PRODUTO) VALUES ('TODDY',5,'NESTLESY','G',500);
  INSERT INTO PRODUTO(NM_PRODUTO,VALOR,MARCA,UNIDADE_MEDIDA_PRODUTO,QUANTIDADE_PRODUTO) VALUES ('CAFE',2,'MELITAY','G',300);
  
  --INSERINDO PESSOA_CARRINHO
  INSERT INTO PESSOA_CARRINHO(CD_PRODUTO,QUANTIDADE,CD_PESSOA,TIPO_PAGAMENTO,DATA_COMPRA) VALUES (1,5,3,'CARTAOC','27/04/2020');
  INSERT INTO PESSOA_CARRINHO(CD_PRODUTO,QUANTIDADE,CD_PESSOA,TIPO_PAGAMENTO,DATA_COMPRA) VALUES (2,5,3,'CARTAOC','27/04/2020');
  INSERT INTO PESSOA_CARRINHO(CD_PRODUTO,QUANTIDADE,CD_PESSOA,TIPO_PAGAMENTO,DATA_COMPRA) VALUES (3,5,3,'CARTAOC','27/04/2020');
  
  --INSERINDO VENDA
  INSERT INTO VENDA(CD_FUNCIONARIO,CD_PESSOA_CARRINHO,NU_CAIXA) VALUES (1,1,1);
  INSERT INTO VENDA(CD_FUNCIONARIO,CD_PESSOA_CARRINHO,NU_CAIXA) VALUES (1,2,5);
  INSERT INTO VENDA(CD_FUNCIONARIO,CD_PESSOA_CARRINHO,NU_CAIXA) VALUES (1,3,3);
  
  --INSERINDO ESTOQUE
  INSERT INTO ESTOQUE(CD_PRODUTO,QUANTIDADE_ESTOQUE) VALUES (1,200);
  
  -- SELECT'S
SELECT P.NOME,C.NM_CARGO,PR.CD_PRODUTO, PR.NM_PRODUTO FROM PESSOA P 
INNER JOIN FUNCIONARIO F ON P.CD_PESSOA=F.CD_PESSOA
INNER JOIN CARGO C ON C.CD_CARGO = F.CD_CARGO
INNER JOIN VENDA V ON F.CD_FUNCIONARIO = V.CD_FUNCIONARIO
INNER JOIN PESSOA_CARRINHO PC ON PC.CD_PESSOA_CARRINHO = V.CD_PESSOA_CARRINHO
INNER JOIN PRODUTO PR ON PR.CD_PRODUTO = PC.CD_PRODUTO;
  
  
  
  
  
  